<ion-content class="main-bg">
  <div class="container">

    <div class="header-section">
      <h3>üìÖ Ch·ªçn l·ªãch kh√°m</h3>
    </div>

    <div class="top-controls">

      <div class="custom-select-wrapper">
        <ion-select [value]="selectedDepartmentId" (ionChange)="onDepartmentChange($event)"
                    interface="popover" placeholder="Ch·ªçn chuy√™n khoa" class="modern-select">
          <ion-select-option *ngFor="let d of departments" [value]="d.id">
            {{ d.departmentName }}
          </ion-select-option>
        </ion-select>
      </div>

      <div class="month-picker-wrapper">
        <ion-datetime-button datetime="datetime"></ion-datetime-button>
        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime id="datetime"
                          presentation="month-year"
                          [(ngModel)]="currentIsoDate"
                          [min]="minDate"
                          [max]="maxDate"
                          (ionChange)="onMonthChange($event)"></ion-datetime>
          </ng-template>
        </ion-modal>
      </div>
    </div>

    <div class="date-section">
      <div class="pagination-controls">
        <button class="nav-btn" (click)="prevPage()" [disabled]="startIndex === 0">
          <ion-icon name="chevron-back"></ion-icon>
        </button>

        <div class="date-list">
          <div class="date-card" *ngFor="let day of visibleDays"
               [class.active]="selectedDate === day.fullDate"
               (click)="selectDate(day)">
            <span class="day-name">{{ day.dayName }}</span>
            <span class="day-number">{{ day.dayNumber }}</span>
          </div>
          <div *ngIf="visibleDays.length === 0" class="no-days-msg">
            Kh√¥ng c√≤n ng√†y l√†m vi·ªác trong th√°ng n√†y
          </div>
        </div>

        <button class="nav-btn" (click)="nextPage()"
                [disabled]="startIndex + pageSize >= allDaysOfMonth.length">
          <ion-icon name="chevron-forward"></ion-icon>
        </button>
      </div>
    </div>

    <div class="time-section" *ngIf="selectedDepartmentId && selectedDate">
      <h4>üïí Ca kh√°m c√≤n tr·ªëng</h4>

      <div class="time-grid" *ngIf="schedules.length > 0; else noSchedule">
        <button class="time-chip" *ngFor="let s of schedules"
                [class.selected]="selectedSchedule?.id === s.id"
                (click)="selectTimeSlot(s)">
          {{ formatTime(s.startTime) }} - {{ formatTime(s.endTime) }}
        </button>
      </div>

      <ng-template #noSchedule>
        <div class="empty-state">
          <p>Kh√¥ng c√≥ l·ªãch kh√°m n√†o.</p>
        </div>
      </ng-template>
    </div>

    <div class="info-section">
      <h4>Th√¥ng tin ng∆∞·ªùi kh√°m b·ªánh</h4>
      <div class="input-box">
        <label>H·ªç v√† T√™n</label>
        <input type="text" placeholder="Nguy·ªÖn VƒÉn A">
      </div>
      <div class="input-box">
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="tel" placeholder="0912345678">
      </div>
      <div class="input-box">
        <label>Email</label>
        <input type="email" placeholder="example@gmail.com">
      </div>
      <div class="input-box">
        <label>L√Ω do kh√°m</label>
        <input type="text" placeholder="Tri·ªáu ch·ª©ng b·ªánh...">
      </div>
      <button class="btn-submit" (click)="onSubmit()">X√°c nh·∫≠n ƒë·∫∑t l·ªãch</button>
    </div>

  </div>
</ion-content>
