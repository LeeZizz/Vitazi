<div class="booking-page">
  <div class="page-title">Chọn lịch khám</div>

  <div class="page-container">

    <!-- Thanh chọn ngày -->
    <div class="date-strip" *ngIf="!isLoadingDays; else loadingDays">
      <div
        class="date-card"
        *ngFor="let day of days; trackBy: trackByDate"
        [class.active]="day === selectedDay"
        (click)="onSelectDay(day)"
      >
        <div class="weekday">{{ day.weekday }}</div>
        <div class="day-number">{{ day.date | date: 'dd' }}</div>
        <div class="month">{{ day.date | date: 'MMM, y' }}</div>
      </div>
    </div>

    <ng-template #loadingDays>
      <div class="loading-center">
        Đang tải lịch khám...
      </div>
    </ng-template>

    <!-- Ca khám -->
    <div class="slot-section" *ngIf="selectedDay">
      <div class="slot-header">
        Ca khám còn trống
      </div>
      <div class="slot-list">
        <button
          type="button"
          class="slot-btn"
          *ngFor="let slot of selectedDay.slots; trackBy: trackBySlot"
          [class.selected]="slot === selectedSlot"
          [class.disabled]="!slot.available"
          (click)="onSelectSlot(slot)"
        >
          {{ slot.start }} - {{ slot.end }}
        </button>
      </div>
    </div>

    <!-- Thông tin người khám -->
    <div class="patient-section">
      <h2>Thông tin người khám bệnh</h2>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">

        <div class="input-group">
          <label>Họ và tên *</label>
          <input
            type="text"
            formControlName="fullName"
            placeholder="Nhập họ tên của bạn"
          />
        </div>

        <div class="input-group">
          <label>Số điện thoại *</label>
          <input
            type="tel"
            formControlName="phone"
            placeholder="Nhập số điện thoại của bạn"
          />
        </div>

        <div class="input-group">
          <label>Email</label>
          <input
            type="email"
            formControlName="email"
            placeholder="Nhập email của bạn"
          />
        </div>

        <div class="input-group">
          <label>Lý do khám</label>
          <input
            type="text"
            formControlName="reason"
            placeholder="Nhập lý do khám của bạn"
          />
        </div>

        <div class="notify-row">
          <input type="checkbox" formControlName="receiveNotify" />
          <span>Tôi muốn nhận thông báo về lịch khám này</span>
        </div>

        <div class="error" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <button
          type="submit"
          class="submit-btn"
          [disabled]="isSubmitting"
        >
          <ng-container *ngIf="!isSubmitting; else submitting">
            Đặt lịch
          </ng-container>
        </button>

        <ng-template #submitting>
          Đang gửi...
        </ng-template>

      </form>
    </div>

  </div>
  <div class="toast-success" *ngIf="showSuccessToast">
    {{ successMessage }}
  </div>
</div>
