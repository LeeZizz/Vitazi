<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>Đăng ký lịch khám</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="booking-bg">
  <div class="booking-container">

    <div class="form-card">
      <h3 class="card-title">1. Chọn nơi khám</h3>

      <div class="input-group">
        <label>Phòng khám</label>
        <div class="custom-select">
          <ion-select [(ngModel)]="selectedClinicId" (ionChange)="onClinicChange()" placeholder="Chọn phòng khám" interface="action-sheet">
            <ion-select-option *ngFor="let c of clinics" [value]="c.id">{{ c.clinicName }}</ion-select-option>
          </ion-select>
        </div>
      </div>

      <div class="input-group">
        <label>Chuyên khoa</label>
        <div class="custom-select" [class.disabled]="!selectedClinicId">
          <ion-select [(ngModel)]="selectedDepartmentId" (ionChange)="onDepartmentOrDateChange()" placeholder="Chọn chuyên khoa" interface="action-sheet" [disabled]="!selectedClinicId">
            <ion-select-option *ngFor="let d of departments" [value]="d.id">{{ d.departmentName }}</ion-select-option>
          </ion-select>
        </div>
      </div>
    </div>

    <div class="form-card" *ngIf="selectedDepartmentId">
      <h3 class="card-title">2. Chọn thời gian</h3>

      <div class="date-wrapper">
        <ion-datetime
          presentation="date"
          [(ngModel)]="selectedDate"
          (ionChange)="onDepartmentOrDateChange()"
          [min]="selectedDate"
          locale="vi-VN"
        ></ion-datetime>
      </div>

      <div class="schedule-section">
        <p class="sub-label" *ngIf="schedules.length > 0">Ca khám còn trống:</p>

        <div class="schedule-grid">
          <div
            class="time-slot"
            *ngFor="let s of schedules"
            [class.selected]="selectedSchedule?.id === s.id"
            (click)="selectSchedule(s)">
            {{ formatTime(s.startTime) }} - {{ formatTime(s.endTime) }}
          </div>
        </div>

        <div class="empty-state" *ngIf="schedules.length === 0">
          <p>Không có lịch khám nào trong ngày này.</p>
        </div>
      </div>
    </div>

    <div class="form-card" *ngIf="selectedSchedule">
      <h3 class="card-title">3. Thông tin bệnh nhân</h3>

      <div class="input-item">
        <ion-input label="Họ và Tên" labelPlacement="stacked" [(ngModel)]="patientName" placeholder="Ví dụ: Nguyễn Văn A" fill="outline"></ion-input>
      </div>

      <div class="input-item">
        <ion-input label="Số điện thoại" labelPlacement="stacked" [(ngModel)]="patientPhone" type="tel" placeholder="0912..." fill="outline"></ion-input>
      </div>

      <div class="input-item">
        <ion-input label="Email (Tuỳ chọn)" labelPlacement="stacked" [(ngModel)]="patientEmail" type="email" placeholder="example@gmail.com" fill="outline"></ion-input>
      </div>

      <div class="input-item">
        <ion-textarea label="Triệu chứng / Lý do" labelPlacement="stacked" [(ngModel)]="description" placeholder="Đau đầu, sốt..." fill="outline" rows="3"></ion-textarea>
      </div>

      <ion-button expand="block" class="confirm-btn" (click)="onSubmit()">
        Xác nhận đặt lịch
      </ion-button>
    </div>

  </div>
</ion-content>
