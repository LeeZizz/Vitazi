<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="close()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>ƒê·ªïi l·ªãch kh√°m</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="modal-content">

  <div class="content-wrapper">
    <div class="section-group">
      <div class="section-header">
        <span class="step-badge">1</span>
        <span class="step-title">Ch·ªçn ng√†y m·ªõi</span>
      </div>

      <div class="calendar-card">
        <ion-datetime
          presentation="date"
          [value]="selectedDate"
          [min]="minDate"
          (ionChange)="onDateChange($event)"
          locale="vi-VN"
          size="cover">
        </ion-datetime>
      </div>
    </div>

    <div class="section-group">
      <div class="section-header">
        <span class="step-badge">2</span>
        <span class="step-title">Ch·ªçn ca l√†m vi·ªác</span>
      </div>

      <div class="state-container" *ngIf="loading">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>ƒêang t√¨m ca tr·ªëng...</p>
      </div>

      <div class="state-container" *ngIf="!loading && schedules.length === 0">
        <div class="empty-icon">üìÖ</div>
        <p>Kh√¥ng c√≥ ca l√†m vi·ªác n√†o trong ng√†y n√†y.</p>
      </div>

      <ion-radio-group [(ngModel)]="selectedScheduleId" *ngIf="!loading && schedules.length > 0">
        <div class="schedule-grid">
          <div
            class="schedule-card"
            *ngFor="let s of schedules"
            [class.selected]="selectedScheduleId === s.id"
            [class.disabled]="!s.isActive"
            (click)="s.isActive ? (selectedScheduleId = s.id) : null">

            <ion-radio [value]="s.id" style="display:none"></ion-radio>

            <div class="card-content">
              <div class="time-range">
                {{ formatTime(s.startTime) }} - {{ formatTime(s.endTime) }}
              </div>

              <div class="capacity-badge" [class.full]="!s.isActive">
                <ng-container *ngIf="s.isActive">
                  C√≤n {{ s.maxCapacity - s.capacity }} ch·ªó
                </ng-container>
                <ng-container *ngIf="!s.isActive">
                  ƒê√£ kh√≥a/ƒê·∫ßy
                </ng-container>
              </div>
            </div>

            <div class="check-icon" *ngIf="selectedScheduleId === s.id">
              <ion-icon name="checkmark-circle"></ion-icon>
            </div>
          </div>
        </div>
      </ion-radio-group>
    </div>
  </div>

</ion-content>

<ion-footer class="ion-no-border">
  <div class="footer-actions">
    <ion-button expand="block" class="save-btn" (click)="save()" [disabled]="!selectedScheduleId">
      X√°c nh·∫≠n thay ƒë·ªïi
    </ion-button>
  </div>
</ion-footer>
